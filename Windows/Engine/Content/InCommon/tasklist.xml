<?xml version="1.0" encoding="utf-8" ?>
<Content xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xsi:schemaLocation="http://incert.incommon.org/schemas ../Schemas/tasklist.xsd">
  <Branches>
    <RoleBranch name="main" role="Remote" roleMode="Normal">
      <Control.GetContentFromEndpoint>
        <Properties>
          <ContentName>credentials.xml</ContentName>
          <ContentName>certificates.xml</ContentName>
          <ContentName>restorepoint.xml</ContentName>
          <ContentName>wireless.xml</ContentName>
          <ContentName>systemintegrity.xml</ContentName>
          <ContentName>antimalware.xml</ContentName>
          <ContentName>networksecurity.xml</ContentName>
          <ContentName>screensaver.xml</ContentName>
          <ContentName>windowsupdate.xml</ContentName>
        </Properties>
      </Control.GetContentFromEndpoint>
      
      <Settings.SetSettingText>
        <Properties>
          <Setter key="certificate provider">incommontest.org</Setter>
          <Setter key="credential2">cred2</Setter>
          <Setter key="credential3">cred3</Setter>
          <Setter key="credential4">cred4</Setter>
        </Properties>
      </Settings.SetSettingText>

      <!-- hide the splash screen dialog raised by bootstrap tasklist -->
      <UserInterface.HideDialog>
        <Properties>
          <Dialog>Splash screen dialog</Dialog>
        </Properties>
      </UserInterface.HideDialog>

      <Control.ReturnBranchResult errorBranch="handle authentication issues">
        <Properties>
          <Branch>Authenticate</Branch>
        </Properties>
      </Control.ReturnBranchResult>

      <Logging.SetLogUsername forwardOnly="true">
        <Properties>
          <Username>[username]</Username>
        </Properties>
      </Logging.SetLogUsername>

      <Settings.RetrieveSettingsString forwardOnly="true">
        <Properties>
          <Setter key="agreeToLicense">LicenseAccepted</Setter>
        </Properties>
      </Settings.RetrieveSettingsString>

      <UserInterface.ShowHtmlBannerModal>
        <Properties>
          <Dialog>Main dialog</Dialog>
          <Url>html/license.html</Url>
        </Properties>
      </UserInterface.ShowHtmlBannerModal>
  
      <Settings.PersistSettingsString forwardOnly="true">
        <Properties>
          <Setter key="agreeToLicense">LicenseAccepted</Setter>
        </Properties>
      </Settings.PersistSettingsString>

      <UserInterface.ShowHtmlBannerModal>
        <Properties>
          <Dialog>Main dialog</Dialog>
          <Url>html/begin.html</Url>
        </Properties>
      </UserInterface.ShowHtmlBannerModal>

      <UserInterface.ShowHtmlBanner>
        <Properties>
          <Dialog>Main dialog</Dialog>
          <Url>html/progress.html</Url>
        </Properties>
      </UserInterface.ShowHtmlBanner>
   
      <Control.ReturnBranchResult message="Creating new system restore point">
        <Properties>
          <Branch>restorepoint.set restore point</Branch>
        </Properties>
      </Control.ReturnBranchResult>

      <Control.ReturnBranchResult message="Confirming administrator account credentials">
        <Properties>
          <Branch>credentials.verify admin account credentials</Branch>
        </Properties>
      </Control.ReturnBranchResult>

      <Control.ReturnBranchResult message="Verifying system integrity">
        <Properties>
          <Branch>antimalware.evaluate</Branch>
        </Properties>
      </Control.ReturnBranchResult>

      <Control.ReturnBranchResult message="Checking Windows Security Center">
        <Properties>
          <Branch>systemintegrity.verify security center</Branch>
        </Properties>
      </Control.ReturnBranchResult>

      <Control.ReturnBranchResult message="Checking anti-virus software">
        <Properties>
          <Branch>systemintegrity.verify anti-virus software</Branch>
        </Properties>
      </Control.ReturnBranchResult>

      <Control.ReturnBranchResult message="Checking anti-spyware software">
        <Properties>
          <Branch>systemintegrity.verify anti-spyware software</Branch>
        </Properties>
      </Control.ReturnBranchResult>
   
      <Control.ReturnBranchResult message="Configuring Network Security">
        <Properties>
          <Branch>networksecurity.configure</Branch>
        </Properties>
      </Control.ReturnBranchResult>

      <Control.ReturnBranchResult message="Configuring Windows Update">
        <Properties>
          <Branch>windowsupdate.configure</Branch>
        </Properties>
      </Control.ReturnBranchResult>

      <Control.ReturnBranchResult message="Configuring screen saver">
        <Properties>
          <Branch>screensaver.configure</Branch>
        </Properties>
      </Control.ReturnBranchResult>

      <Control.ReturnBranchResult message="Configuring certificate">
        <Properties>
          <Branch>certificates.configure</Branch>
        </Properties>
      </Control.ReturnBranchResult>

      <Control.ReturnBranchResult message="Adding wireless profiles">
        <Properties>
          <Branch>wireless.add profiles</Branch>
        </Properties>
      </Control.ReturnBranchResult>

      <Registration.RegisterComputer message="Registering computer" minimumTaskTime="1">
        <Properties>
          <UsernameKey>username</UsernameKey>
          <PassphraseKey>passphrase</PassphraseKey>
          <Credential2Key>credential2</Credential2Key>
          <Credential3Key>credential3</Credential3Key>
          <Credential4Key>credential4</Credential4Key>
          <CertificateProvider>[certificate provider]</CertificateProvider>
        </Properties>
      </Registration.RegisterComputer>
      
      <UserInterface.ShowHtmlBannerModal>
        <Properties>
          <Dialog>Main dialog</Dialog>
          <Url>html/finish.html</Url>
        </Properties>
      </UserInterface.ShowHtmlBannerModal>
    </RoleBranch>

    <TaskBranch name="Authenticate">
      <Settings.RetrieveSettingsString>
        <Properties>
          <Setter key="username">Username</Setter>
        </Properties>
      </Settings.RetrieveSettingsString>

      <UserInterface.ShowHtmlBannerModal>
        <Properties>
          <Dialog>Main dialog</Dialog>
          <Url>html/login.html</Url>
          <Width>600</Width>
          <Height>700</Height>
        </Properties>
      </UserInterface.ShowHtmlBannerModal>

      <Settings.PersistSettingsString id="authenticating">
        <Properties>
          <Setter key="username">Username</Setter>
        </Properties>
      </Settings.PersistSettingsString>

      <Authentication.AuthenticateUser>
        <Properties>
          <UsernameKey>username</UsernameKey>
          <PassphraseKey>passphrase</PassphraseKey>
          <Credential2Key>credential2</Credential2Key>
          <Credential3Key>credential3</Credential3Key>
          <Credential4Key>credential4</Credential4Key>
          <CertificateProvider>[certificate provider]</CertificateProvider>
        </Properties>
      </Authentication.AuthenticateUser>
  </TaskBranch>


    <TaskBranch name="handle authentication issues">
      <Control.PreserveLastResult>
        <Properties>
          <SettingKey>generic issue retry banner stored result</SettingKey>
        </Properties>
      </Control.PreserveLastResult>

      <Control.ReturnPreservedResult>
        <Conditions.All>
          <Control.IsNotResultType resultKey="generic issue retry banner stored result" resultType="Errors.Authentication.CouldNotAuthenticateUser"/>
        </Conditions.All>
        <Properties>
          <SettingKey>generic issue retry banner stored result</SettingKey>
        </Properties>
      </Control.ReturnPreservedResult>

      <UserInterface.StopMessageTimer>
        <Properties>
          <SettingKey>AuthenticatingMessage</SettingKey>
        </Properties>
      </UserInterface.StopMessageTimer>

      <Settings.SetSettingText>
        <Properties>
          <Setter key="generic issue retry banner title">Authentication Failed - Retry?</Setter>
          <Setter key="generic issue retry banner description">!ApplicationTitle! could not verify your network credentials.</Setter>
          <Setter key="generic issue retry banner help topic">close utility</Setter>
        </Properties>
      </Settings.SetSettingText>

      <UserInterface.ShowHtmlBannerModal>
        <Properties>
          <Dialog>retry dialog</Dialog>
          <ParentDialog>Main dialog</ParentDialog>
          <Url>resource://html/GenericRetry.html</Url>
          <Width>500</Width>
          <Height>350</Height>
        </Properties>
      </UserInterface.ShowHtmlBannerModal>
    </TaskBranch>
  </Branches>
</Content>
